<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      微信小程序开发总结 | Hexo 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="John Doe">
    
    

    <meta name="description" content="微信小程序开发总结 **一、**开发小程序的第一步，需要申请一个小程序帐号，并且获到小程序的 AppID 。 **二、**微信开发者工具:下载页面根据自己的操作系统下载对应的安装包进行安装。 **三、**小程序代码组成：小程序由配置代码JSON文件、模板代码 WXML 文件、样式代码 WXSS文件以及逻辑代码 JavaScript文件组成。 （1）一个小程序主体部分由 app.js、app.jso">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序开发总结 | Hexo">
<meta property="og:url" content="https://github.com/JinKD/jinkaida.github.io.git/2019/03/15/这是一个新的带图片的博客/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="微信小程序开发总结 **一、**开发小程序的第一步，需要申请一个小程序帐号，并且获到小程序的 AppID 。 **二、**微信开发者工具:下载页面根据自己的操作系统下载对应的安装包进行安装。 **三、**小程序代码组成：小程序由配置代码JSON文件、模板代码 WXML 文件、样式代码 WXSS文件以及逻辑代码 JavaScript文件组成。 （1）一个小程序主体部分由 app.js、app.jso">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-03-15T08:13:51.340Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微信小程序开发总结 | Hexo">
<meta name="twitter:description" content="微信小程序开发总结 **一、**开发小程序的第一步，需要申请一个小程序帐号，并且获到小程序的 AppID 。 **二、**微信开发者工具:下载页面根据自己的操作系统下载对应的安装包进行安装。 **三、**小程序代码组成：小程序由配置代码JSON文件、模板代码 WXML 文件、样式代码 WXSS文件以及逻辑代码 JavaScript文件组成。 （1）一个小程序主体部分由 app.js、app.jso">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Hexo</a></h1>
        <hr class="panel-cover__divider">

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title class>关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title class>归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">微信小程序开发总结</h1>

    

    <div class="post-meta">
      <time datetime="2019-03-15" class="post-meta__date date">2019-03-15</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p><strong>微信小程序开发总结</strong></p>
<p>**一、**<strong>开发小程序的第一步，需要申请一个小程序帐号，并且获到小程序的 AppID 。</strong></p>
<p>**二、**<strong>微信开发者工具:下载页面根据自己的操作系统下载对应的安装包进行安装。</strong></p>
<p>**三、**<strong>小程序代码组成</strong>：小程序由配置代码JSON文件、模板代码 WXML 文件、样式代码 WXSS文件以及逻辑代码 JavaScript文件组成。</p>
<p>（1）一个小程序主体部分由 app.js、app.json、app.wxss  如图1，三个文件组成，必须放在项目的根目录，分别是整个程序的逻辑、全局配置及样式。</p>
<p>![img](file:////tmp/wps-jinkaida/ksohtml/wpsu4pK2Z.jpg)</p>
<p>图1</p>
<p>​	1. app.js 是小程序的脚本代码。通过App()函数用来注册一个小程序，接受一个 Object 参数，指定小程序的生命周期函数等。</p>
<p>​	2. app.json 是对整个小程序的全局配置。app.json是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部tab等.</p>
<p>v pages字段 —— 用于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录。</p>
<p>v window字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等。</p>
<p>​	3. app.wxss  是整个小程序的公共样式表。</p>
<p>4.工具配置 project.config.json ：主要是做一些个性化配置，例如界面颜色、编译配置等，当重新安装或者换电脑时候无需重复配置，只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置。</p>
<h4></h4>
<p>（2） pages 里面则是小程序的各个页面，一个界面由wxml、wxss、js、json等四个文件组成如 图2，界面结构，样式，页面的逻辑、以及配置。</p>
<p>![img](file:////tmp/wps-jinkaida/ksohtml/wpsXEv7nz.jpg)</p>
<p>图2</p>
<p>**四、**<strong>小程序宿主环境</strong></p>
<p>（1）渲染层和逻辑层</p>
<p>小程序的运行环境分成渲染层和逻辑层，WXML 模板和 WXSS 样式工作在渲染层，JS 脚本工作在逻辑层。渲染层的界面使用了WebView 进行渲染；逻辑层采用JsCore线程运行JS脚本。</p>
<p>注意：</p>
<p>v 渲染层和数据相关。（数据驱动）</p>
<p>v 逻辑层负责产生、处理数据</p>
<p>v 逻辑层通过 Page 实例的 setData 方法传递数据到渲染层</p>
<h2>（2）程序与页面</h2>
<h2>1.程序：宿主环境提供了 App() 构造器用来注册一个程序App，App() 构造器必须写在项目根目录的app.js里，App实例是单例对象，在其他JS脚本中可以使用宿主环境提供的 getApp() 来获取程序实例。App构造器接受一个Object参数，onLaunch / onShow / onHide 三个回调是App实例的生命周期函数。</h2>
<p>2.页面：一个页面是分三部分组成：界面、配置和逻辑。界面由WXML文件和WXSS文件来负责描述，配置由JSON文件进行描述，页面逻辑则是由JS脚本文件负责。一个页面的文件需要放置在同一个目录下，其中WXML文件和JS文件是必须存在的，JSON和WXSS文件是可选的。页面路径需要在小程序代码根目录app.json中的pages字段声明。默认pages字段的第一个页面路径为小程序的首页。</p>
<p>3.宿主环境提供了 Page() 构造器用来注册一个小程序页面，Page()在页面脚本page.js中调用，Page构造器接受一个Object参数，其中data属性是当前页面WXML模板中可以用来做数据绑定的初始数据，onLoad / onReady / onShow / onHide /onUnload 5个回调是Page实例的生命周期函数，onPullDownRefresh / onReachBottom / onShareAppMessage / onPageScroll 4个回调是页面的用户行为。</p>
<p>this.setData注意事项：</p>
<p>v 直接修改 Page实例的this.data 而不调用 this.setData 是无法改变页面的状态的，还会造成数据不一致。</p>
<p>v 由于setData是需要两个线程的一些通信消耗，为了提高性能，每次设置的数据不应超过1024kB。</p>
<p>v 不要把data中的任意一项的value设为undefined，否则可能会有引起一些不可预料的bug。</p>
<p>4.页面跳转和路由：一个小程序拥有多个页面，我们可以通过wx.navigateTo推入一个新的页面，小程序宿主环境限制了这个页面栈的最大层级为10层。具体跳转方法如下：</p>
<p>v wx.navigateTo({ url: 'pageD' }) 可以往当前页面栈多推入一个 pageD。</p>
<p>v wx.navigateBack() 可以退出当前页面栈的最顶上页面。</p>
<p>v wx.redirectTo({ url: 'pageE' }) 是替换当前页变成pageE。</p>
<p>（3）组件：一个小程序页面可以分解成多个部分组成，组件就是小程序页面的基本组成单元。小程序的宿主环境提供了一系列基础组件。需要注意的是所有组件名和属性都是小写，多个单词会以英文横杠 &quot;-&quot; 进行连接。</p>
<p>组件包括：</p>
<p>视图容器：view，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html" target="_blank" rel="noopener">scroll-view</a>，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html" target="_blank" rel="noopener">swiper</a>，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/movable-view.html" target="_blank" rel="noopener">movable-view</a>/<a href="#movable-area">movable-area</a>，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html" target="_blank" rel="noopener">cover-view</a>，<a href="#cover-image">cover-image</a></p>
<p>基础内容：icon，text，rich-text，progress</p>
<p>表单组件：button，checkbox，form，input，label，picker，picker-view，radio，slider ,  switch , textarea</p>
<p>导航：navigator,functional-page-navigator(仅在插件中有效，用于跳转到插件功能页)</p>
<p>媒体组件：audio，image，video，camera，live-player , live-pusher.</p>
<p>地图：map</p>
<p>画布：canvas</p>
<p>开放能力：open-data , web-view , ad , official-account</p>
<p>其中camera，canvas，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/input.html" target="_blank" rel="noopener">input</a>（仅在focus时表现为原生组件），live-player , live-pusher. Map ，textarea，video 是由客户端创造的原生组件。</p>
<p>（4）API:宿主环境提供了丰富的API，可以很方便调起微信提供的能力.小程序提供的API按照功能主要分为几大类：网络、媒体、文件、数据缓存、位置、设备、界面、界面节点信息还有一些特殊的开放接口。</p>
<p>（5）事件：用户在渲染层的行为反馈”以及“组件的部分状态反馈”抽象为渲染层传递给逻辑层的“ 事件。常见事件类型如：touchstart，touchmove，touchcancel，touchend，tap，longpress等。事件绑定的写法和组件属性一致，以key=&quot;value&quot;的形式，key以bind或者catch开头，然后跟上事件的类型，如bindtap、catchtouchstart。</p>
<h1><strong>五、<strong><strong>小程序的</strong></strong>场景应用</strong></h1>
<h2>（1）小程序基本的布局方法——Flex布局。</h2>
<h3>（2）常见的交互反馈，如： 触摸反馈，Toast和模态对话框，界面滚动。</h3>
<p>（3）发起HTTPS网络通信:使用wx.request这个API进行相关配置。</p>
<h2>（4）微信登录</h2>
<h2>Ø 小程序通过wx.login()获取到微信登录凭证code</h2>
<h2>Ø 小程序通过wx.request把code带到自己服务器</h2>
<h2>Ø 通过code和其他信息换取用户ID</h2>
<h2>Ø 绑定微信用户和自己业务用户ID</h2>
<h2>Ø 生成自己业务登录凭证SessionID</h2>
<h2>Ø 第三方服务器返回业务登录凭证SessionID给小程序</h2>
<h2>Ø 小程序下次wx.request带上SessionID进行业务交互</h2>
<p>(5) 本地数据缓存</p>
<p>1.通过wx.getStorage/wx.getStorageSync读取本地缓存，通wx.setStorage/wx.setStorageSync写数据到缓存。缓存限制和隔离：</p>
<p>2.不同小程序的本地缓存空间是分开的，每个小程序的缓存空间上限为10MB。宿主环境还对不同用户的缓存进行了隔离，避免用户间的数据隐私泄露。由于本地缓存是存放在当前设备，用户换设备之后无法从另一个设备读取到当前设备数据。因此用户的关键信息不建议只存在本地缓存，应该把数据放到服务器端进行持久化存储。此外，</p>
<p>3还可以利用本地缓存提前渲染页面，解决延迟渲染的现象。</p>
<p>4.利用本地缓存的能力来持久化存储SessionId。</p>
<p>​      (6) 小程序常用操作设备能力</p>
<p>\1. 利用微信扫码能力  （wx.scanCode）</p>
<p>\2.  获取网络状态    （wx.getNetworkType）</p>
<h1><strong>六、</strong> <strong>小程序的协同工作和发布</strong></h1>
<p>(1) 协同工作</p>
<h3>1.人员组织结构：分为项目管理，产品组，设计组，开发组，测试组</h3>
<p>2.小程序平台给不同角色定义了7种权限：开发者权限，体验者权限，登录，数据分析，开发管理，开发设置，暂停服务设置。</p>
<h3>(2) 用户体验审视</h3>
<h3>(3) 发布</h3>
<h3>1.  发布前最后的检查</h3>
<p>\2. 发布模式:小程序提供了两种发布模式：全量发布和分阶段发布。全量发布是指当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本。分阶段发布是指分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布。</p>
<h4>(4) 运营：数据分析:常规分析,自定义分析</h4>
<h2></h2>
<p><strong>七、底层框架</strong></p>
<p>（1）技术选型：选择类似于微信 JSSDK 这样的 Hybrid 技术，即界面主要由成熟的 Web 技术渲染，辅之以大量的接口提供丰富的客户端原生能力。同时，每个小程序页面都是用不同的WebView去渲染，这样可以提供更好的交互体验，更贴近原生体验，也避免了单个WebView的任务过于繁重。此外，界面渲染这一块我们定义了一套内置组件以统一体验，并且提供一些基础和通用的能力，其中内置组件有一部分较复杂组件是用客户端原生渲染的，以提供更好的性能。</p>
<p>（2）管控与安全：创建一个单独的线程去执行 JavaScript，在这个环境下执行的都是有关小程序业务逻辑的代码，也就是我们前面一直提到的逻辑层，在iOS下用内置的 JavaScriptCore框架，在安卓则是用腾讯x5内核提供的JsCore环境。而界面渲染相关的任务全都在WebView线程里执行，通过逻辑层代码去控制渲染哪些界面，那么这一层当然就是所谓的渲染层。</p>
<p>（3）组件系统：Exparser是微信小程序的组件组织框架，内置在小程序基础库中，为小程序的各种组件提供基础的支持。</p>
<p>（4）在内置组件中，有一些组件较为特殊，它们并不完全在Exparser的渲染体系下，而是由客户端原生参与组件的渲染，这类组件我们称为“原生组件”。</p>
<h2>（5）小程序与客户端通信原理：</h2>
<p>​      1.视图层组件 ：iOS 是利用了WKWebView 的提供 messageHandlers 特性，而在安卓则是往 WebView 的 window 对象注入一个原生方法，最终会封装成 WeiXinJSBridge 这样一个兼容层，主要提供了调用（invoke）和监听（on）这两种方法。</p>
<p>2.逻辑层接口：逻辑层与客户端原生通信机制与渲染层类似，不同在于，iOS平台可以往JavaScripCore框架注入一个全局的原生方法，而安卓方面则是跟渲染层一致的。</p>
<p><strong>八、性能优化</strong></p>
<p>（1）控制小程序包的大小（精简代码，去掉不必要的WXML结构和未使用的WXSS定义，减少在代码包中直接嵌入的资源文件，压缩图片，使用适当的图片格式）如小程序比较复杂，优化后的代码总量可能仍然比较大，此时可以采用分包加载的方式进行优化。</p>
<p>（2）页面层级准备---主要分为三个阶段：</p>
<p>a. 第一阶段是启动一个WebView，在iOS和Android系统上，操作系统启动WebView都需要一小段时间。</p>
<p>b. 第二阶段是在WebView中初始化基础库，此时还会进行一些基础库内部优化，以提升页面渲染性能。</p>
<p>c. 第三阶段是注入小程序WXML结构和WXSS样式，使小程序能在接收到页面初始数据之后马上开始渲染页面（这一阶段无法在小程序启动前执行）。</p>
<p>（3） 数据通信</p>
<p>a. 页面初始数据通信</p>
<p>b. 更新数据通信</p>
<p>v 不要过于频繁调用setData，应考虑将多次setData合并成一次setData调用；</p>
<p>v 数据通信的性能与数据量正相关，因而如果有一些数据字段不在界面中展示且数据结构比较复杂或包含长字符串，则不应使用setData来设置这些数据；</p>
<p>v 与界面渲染无关的数据最好不要设置在data中，可以考虑设置在page对象的其他字段下。</p>
<p>c. 用户事件通信</p>
<p>v 去掉不必要的事件绑定（WXML中的bind和catch），从而减少通信的数据量和次数；</p>
<p>v 事件绑定时需要传输target和currentTarget的dataset，因而不要在节点的data前缀属性中放置过大的数据。</p>
<p>​    （4）视图层渲染</p>
<p>v 减少WXML中节点的数量可以有效降低初始渲染和重渲染的时间开销，提升渲染性能。</p>
<p>v 去掉不必要设置的数据、减少setData的数据量也有助于提升这一个步骤的性能。</p>
<p>（5）原生组件通信：使用context时，数据从逻辑层传到native层后，直接传入组件中，这样可以显著降低传输延迟。</p>
<p>**九、**<strong>微信开发者工具</strong></p>
<p>（1）代码编译：微信开发者工具和微信客户端都无法直接运行小程序的源码，因此我们需要对小程序的源码进行编译。代码编译过程包括本地预处理、本地编译和服务器编译。</p>
<h3>v 编译WXML</h3>
<h3>v 编译WXSS</h3>
<p>v 编译javaScript</p>
<p>（2）模拟器</p>
<p>v 逻辑层模拟</p>
<p>v 渲染层模拟</p>
<p>v 客户端模拟</p>
<p>v 通讯模拟</p>
<p>（3）调试器：代码调试是开发者工具的最主要的功能之一，包括界面调试和逻辑调试。</p>
<p>**十、**<strong>小程序发布准备以及上线</strong></p>
<p>（1）管理员可在小程序管理后台统一管理项目成员（包括开发者、体验者及其他成员）、设置项目成员的权限，包括：开发者/体验者权限、登录小程序管理后台、开发管理、查看小程序数据分析等</p>
<p>（2）预览：使用开发者工具可以预览小程序，帮助开发者检查小程序在移动客户端上的真实表现</p>
<p>（3） 使用开发者工具可以预览小程序，帮助开发者检查小程序在移动客户端上的真实表现。</p>
<p>（4）上传代码：用于提交体验或者审核使用的</p>
<p>（5）提交审核（必须经过严格测试以后）</p>
<p>（6）发布：审核通过之后，管理员的微信中会收到小程序通过审核的通知，此时登录 <a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener">小程序管理后台</a> - 开发管理 - 审核版本中可以看到通过审核的版本。</p>
<p>请点击发布，即可发布小程序。</p>
<p>（7）运营数据分析</p>
<p>方法一：</p>
<p>登录 <a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener">小程序管理后台</a> - 数据分析</p>
<p>点击相应的 tab 可以看到相关的数据。</p>
<p>方法二：</p>
<p>使用小程序数据助手，在微信中方便的查看运营数据</p>
<h3></h3>
<h3></h3>
<h3></h3>
<h2></h2>
<h3></h3>
<h3></h3>
<p>​</p>
<h4></h4>
<h3></h3>
<h3></h3>
<h3></h3>
<h3></h3>
<h2></h2>
<h2></h2>
<h3></h3>
<h3></h3>
<h2></h2>
<h2></h2>
<h2></h2>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/jquery.min.js"></script>
    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
